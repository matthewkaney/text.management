<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <style type="text/css">
      html,
      body {
        margin: 0;
        width: 100%;
        height: 100%;
      }

      canvas {
        display: block;
      }
    </style>
    <script src="https://unpkg.com/hydra-synth"></script>
    <script type="module">
      //@ts-ignore
      import Hydra from "hydra-synth";
      import { getMessages } from "../../osc/osc";

      console.log("Test");

      window.addEventListener("message", ({ data, ports }) => {
        console.log("RECEIVED MESSAGE")
        if (data === "channel" && ports.length > 0) {
          console.log("RECEIVED PORTS")
          let [port] = ports;

          port.addEventListener("message", ({ data }) => {
            console.log("received message");
            for (let {
              address,
              args: [code],
            } of getMessages(data)) {
              console.log(address, code);
              if (address === "/code" && typeof code === "string") {
                console.log("codeeee");
                try {
                  eval(code);
                } catch (error) {
                  console.log(error.message);
                }
              }
            }
          });

          port.addEventListener("messageerror", (event) => {
            console.error(event);
          });

          port.start();
        }
      });

      window.addEventListener("load", () => {
        new Hydra({ detectAudio: false });
        //@ts-ignore
        osc(2).out();
      });
    </script>
  </head>
</html>
